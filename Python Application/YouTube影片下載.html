<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube影片下載</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../highlight/styles/github-dark.css">
    <script src="../highlight/highlight.js"></script> 
    <script>hljs.highlightAll();</script> 
</head>
<body>
    <header>
    <h1>YouTube影片下載</h1>
    <nav>
        <ul class="bar-menu">
            <li><a href="../index.html">Home</a></li>
        </ul>
    </nav>
    </header>
    <main>
        <section class="backgroundtwo">
            <h2>前置作業</h2>
            <p>除了內建的標準程式庫，還需先安裝pytube套件，而套件是一組執行某項功能模組的集合。</p>
            <ol>
                <li>首先開啟cmd後，輸入安裝指令pip install pytube --user(user為解決權限問題的選擇性參數)。</li>
                <ul class="Contractiontwo">
                    <li>安裝後可能會有警告，即pytube.exe被安裝的路徑沒有在系統的 PATH 變數中。</li>
                    <li>按下Win+S搜尋「環境變數」，或從系統>進階設定中找出「環境變數」。</li>
                    <li>在「系統變數」區域中，找到名為 PATH 的變數，並將其選中後點擊「編輯」。</li>
                    <li>並新增pytube.exe 的安裝路徑在其中後，重啟命令提示符窗口。</li>
                </ul>
                <li>打開CMD後，可以使用"pip list"列舉已安裝的所有套件。</li>
                <ul>
                    <li>pip list -o：列出可更新的套件。</li>
                    <li>pip install --upgrade 套件名：更新 (--upgrade可用-U取代)</li>
                    <li>pip -m install --upgrade pip：更新pip工具 (m=minimal)</li>
                    <li>pip uninstall 套件名：解除安裝</li>
                    <li>pip show 套件名：顯示套件詳細資料</li>
                </ul>
            </ol>
        </section>

        <section class="backgroundtwo">
            <h2>YouTube影片下載程式碼</h2>
            <article>
                python tube.py -h：確認指令輸入方式。<br>
                usage: tube.py [-h] [-r RESOLUTION] [-o OUTPUT_PATH] url<br>
                positional arguments: url 指定YouTube視訊網址<br>
                options:<br>
                -h, --help            show this help message and exit<br>
                -r RESOLUTION, --resolution RESOLUTION 指定影片畫質，例如: 720p, 1080p<br>
                -o OUTPUT_PATH, --output_path OUTPUT_PATH  指定儲存影片的資料夾<br>
            </article>
            <section class="program">
                <pre><code class="python">
    # 使用此程式前，需先安裝pytube套件
    # 安裝指令pip install pytube --user(user為解決權限問題的選擇性參數)
    # 安裝後可能會有警告，即pytube.exe被安裝的路徑沒有在系統的 PATH 變數中
    # 所以須將pytube.exe的安裝路徑添加到系統的 PATH 變數中
    import argparse
    from pytube import YouTube

    def list_available_resolutions(url):#列舉可用的解析度
        try:
            yt = YouTube(url)
            video_list = yt.streams.filter(type="video").all() #取得全部影片類型的串流物件
            resolutions = set(v.resolution for v in video_list) #建立一個包含可用解析度的集合
            return sorted(resolutions, key=lambda s: int(s[:-1]), reverse=True)
        except Exception as e:
            print(f"獲取解析度時發生錯誤：{e}")
            return []

    def download_video(url, resolution, output_path="."):
        try:
            yt = YouTube(url, on_progress_callback=on_progress)
            video = yt.streams.filter(res=resolution).first() #取得第一個符合resolution的串流物件

            if video:
                print(f"開始下載 {resolution} 影片...")
                video.download(output_path) #將檔案下載到指定資料夾路徑output_path內
                print("下載完成！")
            else:
                print(f"找不到符合 {resolution} 的影片串流。")
        except Exception as e:
            print(f"下載影片時發生錯誤：{e}")

    def on_progress(stream, chunk, remaining): #顯示下載進度
        #steam串流物件 chunk檔案資料內容 remaining尚待下載的位元組大小
        total = stream.filesize #串流物件的檔案大小
        percent = (total - remaining) / total * 100
        print("下載中...{:05.2f}%".format(percent), end="\r")

    def main():
        parser = argparse.ArgumentParser()
        parser.add_argument("url", help="指定YouTube視訊網址")
        parser.add_argument("-r", "--resolution", help="指定影片畫質，例如: 720p, 1080p")
        parser.add_argument("-o", "--output_path", help="指定儲存影片的資料夾")
        args = parser.parse_args()

        if args.url:
            resolutions = list_available_resolutions(args.url)
            if resolutions:
                print("可用解析度：", resolutions)
            else:
                print("無法獲取可用解析度。")

            if args.resolution:
                if args.resolution in resolutions:
                    download_resolution = args.resolution
                else:
                    print("指定的解析度無效，請選擇可用的解析度。")
                    return
            else:
                download_resolution = input("請選擇要下載的解析度：")

            output_path = args.output_path or "."
            download_video(args.url, download_resolution, output_path)
        else:
            print("請提供YouTube網址。")

    if __name__ == "__main__":
        main()
                </code></pre>
            </section>
        </section>
    </main>

    <script>
        document.querySelectorAll('pre code').forEach((block) => {
            if (block.dataset.highlighted) {
                delete block.dataset.highlighted;
            }
            hljs.highlightElement(block);
            block.dataset.highlighted = 'yes';
        });
    </script>
</body>
</html>